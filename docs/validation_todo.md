# 校验规则实现情况（任务 6）

本文记录后端校验规则的“已实现子集”与“待完善清单”，用于后续迭代。

## 已实现（已按标准补齐全量准入校验）
实现位置：`backend/app/services/validation.py`

### 1) 基础必填（子集）
- 针对 `base_info` 常用字段做必填校验（缺失/空串/`-` 视为缺失）。

### 2) 时间顺序
- `BDSJ >= GHSJ`（两者均存在时）。
- `JZSJ >= BDSJ`（两者均存在时）。

### 3) 身份证校验
- 当 `ZJLB=1`（居民身份证）时，校验 15/18 位格式与 18 位校验位。

### 4) 费用关系（子集）
- `ZFY > 0`
- `0 <= ZFJE <= ZFY`
- `SSZLF >= MZF + SSF`（存在时）
- `ZCYF1 >= PFKLF`（存在时）

### 5) 中草药“第一组必填”（子集）
- 当 `CTYPSY=1` 或 `PFKLSY=1` 时，要求至少 1 行中草药明细。
- 明细行内字段完整性检查（herb_type/route_code/route_name）。

### 6) 字典值域合法性（子集）
- 对基础信息常用 RC 字段（性别/婚姻/民族/证件类别/就诊类型/科室/职称/判断类等）做字典校验。
- 对手术字段（麻醉方式 RC013/手术分级 RC029）做字典校验。
- 对中草药字段（HERB_TYPE/DRUG_ROUTE）做字典校验。
- 对诊断编码（ICD10/TCM_DISEASE/TCM_SYNDROME）做字典校验（ICD10 支持 code/merged_code）。

## 后续可选增强
- 若需要更严格的“名称/编码一致性校验”（如 ICD10 名称必须与编码匹配），可在不影响现有提交流程的前提下逐步加严。
